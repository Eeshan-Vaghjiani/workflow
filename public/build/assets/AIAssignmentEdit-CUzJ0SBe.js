import{r as m,v as J,j as e,$ as K,a as k}from"./app-Cz-XC9l4.js";import{A as W}from"./app-layout-DBbC1wJO.js";import{e as u,C as x,a as y,b,c as j}from"./card-tSD26EUH.js";import{B as N}from"./button-Diu-54fO.js";import{I as g}from"./input-gyYvXWbp.js";import{T as S}from"./textarea-_X4jAbSH.js";import{L as r}from"./label-TRCAcQVD.js";import{S as w,a as T,b as $,c as D,d}from"./select-BCpkfbKh.js";import{C as z}from"./calendar-CpjqwzxS.js";import{P as Q,a as Y,b as Z}from"./popover-tRTs676i.js";import{c as ee}from"./utils-CBfrqCZ4.js";import{T as se,a as te,b as _,c as C}from"./tabs-DEpUcAvz.js";import{C as ie}from"./checkbox-jHuaGxxD.js";import{A as ae,a as re,b as ne}from"./alert-C0ieycFd.js";import{u as le}from"./use-toast-LY2u_GWA.js";import{C as de}from"./calendar-Cz-eKFtz.js";import{B as oe}from"./credit-card-CsbvY-q-.js";import{L as ce}from"./loader-circle-DBWAvq_5.js";import{S as me}from"./app-sidebar-layout-BnpPf58W.js";import{f as V}from"./format-C2sziSDG.js";import"./index-B0-ktvjH.js";import"./proxy-DUnCzY_P.js";import"./index-BUtF6_nR.js";import"./index-BdQq_4o_.js";import"./index-MaZke14b.js";import"./index-B_RcF4Vj.js";import"./index-BlXtbhPC.js";import"./index-BtsonFn7.js";import"./index-D6AxyfCr.js";import"./chevron-down-C-4IPUEA.js";import"./createLucideIcon-CfQhLZuM.js";import"./check-DpDReKzm.js";import"./chevron-up-BkkBLiNV.js";import"./en-US-CT0ADQGI.js";import"./setYear-Dg_Q6WC1.js";import"./endOfMonth-D0QkFyMS.js";import"./chevron-right-BnGLYIXb.js";import"./avatar-DLZPR9xF.js";import"./index-CmyQNJFQ.js";import"./dropdown-menu-CMVoGVyb.js";import"./use-animation-CJs_orTr.js";import"./use-animation-CBeboh00.js";import"./users-Da4X3jqK.js";import"./square-check-big-Dvy61Sch.js";import"./user-ILuj1RD-.js";import"./use-appearance-rE9bUEXS.js";import"./sun-C2hnd78D.js";import"./settings-DpzlEckF.js";import"./glass-container-qPlEyThK.js";function ls({group:h,assignment:l,aiGeneratedAssignment:I}){const[B,F]=m.useState("details"),[o,R]=m.useState(new Date(l.due_date)),[E,q]=m.useState(!1),[f,O]=m.useState(""),[P,L]=m.useState(!1),[M,v]=m.useState(null),{toast:H}=le(),{data:a,setData:c,processing:U,errors:n}=J({title:l.title,description:l.description,unit_name:l.unit_name,due_date:l.due_date,status:l.status,tasks:l.tasks.map(t=>({id:t.id,title:t.title,description:t.description,start_date:t.start_date,end_date:t.end_date,status:t.status,priority:t.priority,effort_hours:t.effort_hours,importance:t.importance,assigned_user_id:t.assigned_user_id})),redistribute_tasks:!1});m.useEffect(()=>{o&&c("due_date",V(o,"yyyy-MM-dd"))},[o]);const X=t=>{t.preventDefault();const s=new FormData;s.append("title",a.title),s.append("description",a.description),s.append("unit_name",a.unit_name),s.append("due_date",a.due_date),s.append("status",a.status),s.append("redistribute_tasks",E?"1":"0"),s.append("tasks",JSON.stringify(a.tasks)),k.post(route("ai-tasks.update",{group:h.id,assignment:l.id}),s).then(i=>{i.data.redirect_url&&(window.location.href=i.data.redirect_url)}).catch(i=>{console.error("Error updating assignment:",i)})},p=(t,s,i)=>{const A=[...a.tasks];A[t]={...A[t],[s]:i},c("tasks",A)},G=async t=>{if(t.preventDefault(),!f.trim()){v("Please enter instructions for the AI");return}L(!0),v(null);try{await k.get("/sanctum/csrf-cookie");const s=await k.post(`/groups/${h.id}/ai-tasks/generate`,{prompt:`Please modify the following assignment based on these instructions: ${f}

Current Assignment: ${a.title}
Description: ${a.description}
Unit: ${a.unit_name}
Due Date: ${a.due_date}`},{withCredentials:!0,headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")}});s.data.error?v(s.data.error):s.data.assignment&&(c({...a,title:s.data.assignment.title||a.title,description:s.data.assignment.description||a.description,unit_name:s.data.assignment.unit_name||a.unit_name,due_date:s.data.assignment.due_date||a.due_date}),F("details"),H({title:"Success!",description:"AI has suggested changes to the assignment"}))}catch(s){console.error("AI Edit Error:",s),v("Failed to process AI edit request. Please try again.")}finally{L(!1)}};return e.jsxs(W,{children:[e.jsx(K,{title:`Edit Assignment - ${l.title}`}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Edit AI-Generated Assignment"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["AI Model: ",I.model_used]})})]}),e.jsxs("form",{onSubmit:X,children:[e.jsxs(se,{defaultValue:"details",value:B,onValueChange:F,children:[e.jsxs(te,{className:"mb-6",children:[e.jsx(_,{value:"details",children:"Assignment Details"}),e.jsx(_,{value:"tasks",children:"Tasks"}),e.jsx(_,{value:"ai-edit",children:"AI Edit"}),e.jsx(_,{value:"prompt",children:"Original Prompt"})]}),e.jsx(C,{value:"details",children:e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Assignment Details"}),e.jsx(b,{children:"Edit the basic information about this assignment"})]}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"title",children:"Title"}),e.jsx(g,{id:"title",value:a.title,onChange:t=>c("title",t.target.value)}),n.title&&e.jsx("p",{className:"text-sm text-red-500",children:n.title})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"unit_name",children:"Unit/Course Name"}),e.jsx(g,{id:"unit_name",value:a.unit_name,onChange:t=>c("unit_name",t.target.value)}),n.unit_name&&e.jsx("p",{className:"text-sm text-red-500",children:n.unit_name})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"description",children:"Description"}),e.jsx(S,{id:"description",rows:4,value:a.description,onChange:t=>c("description",t.target.value)}),n.description&&e.jsx("p",{className:"text-sm text-red-500",children:n.description})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"due_date",children:"Due Date"}),e.jsxs(Q,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:ee("w-full justify-start text-left font-normal",!o&&"text-muted-foreground"),children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),o?V(o,"dd/MM/yyyy"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Z,{className:"w-auto p-0",children:e.jsx(z,{mode:"single",selected:o,onSelect:R,initialFocus:!0})})]}),n.due_date&&e.jsx("p",{className:"text-sm text-red-500",children:n.due_date})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"status",children:"Status"}),e.jsxs(w,{value:a.status,onValueChange:t=>c("status",t),children:[e.jsx(T,{children:e.jsx($,{placeholder:"Select status"})}),e.jsxs(D,{children:[e.jsx(d,{value:"active",children:"Active"}),e.jsx(d,{value:"completed",children:"Completed"}),e.jsx(d,{value:"archived",children:"Archived"})]})]}),n.status&&e.jsx("p",{className:"text-sm text-red-500",children:n.status})]})]})})]})}),e.jsx(C,{value:"ai-edit",children:e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),"AI Assignment Editor"]}),e.jsx(b,{children:"Let AI help you improve or modify this assignment. Describe what changes you want to make."})]}),e.jsx(j,{children:e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"ai-prompt",children:"Instructions for AI"}),e.jsx(S,{id:"ai-prompt",placeholder:"Describe how you want to modify this assignment. For example: 'Make this assignment more challenging by adding critical thinking tasks' or 'Simplify the language to make it more accessible'",value:f,onChange:t=>O(t.target.value),className:"h-32"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Be specific about what aspects of the assignment you want to change."})]}),M&&e.jsxs(ae,{variant:"destructive",children:[e.jsx(re,{children:"Error"}),e.jsx(ne,{children:M})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(N,{type:"submit",disabled:P||!f.trim(),children:P?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Generate Suggestions"]})})})]})})]})}),e.jsx(C,{value:"tasks",children:e.jsxs(u,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Tasks"}),e.jsx(b,{children:"Edit the tasks for this assignment"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:"redistribute",checked:E,onCheckedChange:t=>{typeof t=="boolean"&&q(t)}}),e.jsx(r,{htmlFor:"redistribute",children:"Auto-redistribute tasks to all members"})]})]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-6",children:a.tasks.map((t,s)=>e.jsxs(u,{className:"border border-gray-200",children:[e.jsx(x,{className:"py-3",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:`task-${s}-title`,children:"Title"}),e.jsx(g,{id:`task-${s}-title`,value:t.title,onChange:i=>p(s,"title",i.target.value)})]})}),e.jsxs(j,{className:"py-0 space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:`task-${s}-description`,children:"Description"}),e.jsx(S,{id:`task-${s}-description`,rows:2,value:t.description,onChange:i=>p(s,"description",i.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:`task-${s}-priority`,children:"Priority"}),e.jsxs(w,{value:t.priority,onValueChange:i=>p(s,"priority",i),children:[e.jsx(T,{id:`task-${s}-priority`,children:e.jsx($,{placeholder:"Select priority"})}),e.jsxs(D,{children:[e.jsx(d,{value:"low",children:"Low"}),e.jsx(d,{value:"medium",children:"Medium"}),e.jsx(d,{value:"high",children:"High"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:`task-${s}-effort`,children:"Effort (hours)"}),e.jsx(g,{id:`task-${s}-effort`,type:"number",min:"1",max:"100",value:t.effort_hours,onChange:i=>p(s,"effort_hours",parseInt(i.target.value))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:`task-${s}-importance`,children:"Importance (1-5)"}),e.jsx(g,{id:`task-${s}-importance`,type:"number",min:"1",max:"5",value:t.importance,onChange:i=>p(s,"importance",parseInt(i.target.value))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:`task-${s}-assigned`,children:"Assigned To"}),e.jsxs(w,{value:t.assigned_user_id?.toString()||"",onValueChange:i=>p(s,"assigned_user_id",i?parseInt(i):null),children:[e.jsx(T,{id:`task-${s}-assigned`,children:e.jsx($,{placeholder:"Select member"})}),e.jsxs(D,{children:[e.jsx(d,{value:"",children:"Unassigned"}),h&&h.members?h.members.map(i=>e.jsx(d,{value:i.id.toString(),children:i.name},i.id)):null]})]})]})]})]},t.id))})})]})}),e.jsx(C,{value:"prompt",children:e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Original AI Prompt"}),e.jsx(b,{children:"The original prompt used to generate this assignment"})]}),e.jsx(j,{children:e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-md",children:e.jsx("p",{className:"whitespace-pre-wrap",children:I.original_prompt})})})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Cancel"}),e.jsx(N,{type:"submit",disabled:U,children:"Save Changes"})]})]})]})})]})}export{ls as default};
