import{r as c,c as Y,j as e,$ as V,d as A,g as T}from"./app-Cz-XC9l4.js";import{A as W}from"./app-layout-DBbC1wJO.js";import{C,a as S,b as E,c as y,e as I,d as z}from"./card-tSD26EUH.js";import{B as b}from"./button-Diu-54fO.js";import{T as J}from"./textarea-_X4jAbSH.js";import{u as Q}from"./use-toast-LY2u_GWA.js";import{B}from"./badge-DxpFCqhw.js";import{A as X,a as Z,b as ee}from"./alert-C0ieycFd.js";import{T as se,a as re,b as F,c as p,d as te,e as x}from"./table-Cjqruzbm.js";import{P as ae}from"./progress-1_i0ocS1.js";import{C as ie}from"./card-3d-xMNzOEQV.js";import{c as ne,i as v}from"./theme-constants-DVo_7dxB.js";import{m as f}from"./proxy-DUnCzY_P.js";import{B as oe}from"./credit-card-CsbvY-q-.js";import{L as k}from"./loader-circle-DBWAvq_5.js";import{S as de}from"./app-sidebar-layout-BnpPf58W.js";import{c as le}from"./createLucideIcon-CfQhLZuM.js";import{R as ce}from"./refresh-cw-CvPiLkiZ.js";import{C as me}from"./clock-DzskyGux.js";import{C as he}from"./circle-alert-DaK2Z9wZ.js";import{U as pe}from"./users-Da4X3jqK.js";import{f as xe}from"./format-C2sziSDG.js";import{p as ue}from"./parseISO-Dmh2dHml.js";import"./index-B0-ktvjH.js";import"./utils-CBfrqCZ4.js";import"./index-MaZke14b.js";import"./index-BUtF6_nR.js";import"./input-gyYvXWbp.js";import"./dropdown-menu-CMVoGVyb.js";import"./index-B_RcF4Vj.js";import"./index-BlXtbhPC.js";import"./index-BtsonFn7.js";import"./avatar-DLZPR9xF.js";import"./index-CmyQNJFQ.js";import"./use-animation-CJs_orTr.js";import"./use-animation-CBeboh00.js";import"./chevron-right-BnGLYIXb.js";import"./square-check-big-Dvy61Sch.js";import"./calendar-Cz-eKFtz.js";import"./user-ILuj1RD-.js";import"./use-appearance-rE9bUEXS.js";import"./sun-C2hnd78D.js";import"./settings-DpzlEckF.js";import"./glass-container-qPlEyThK.js";import"./en-US-CT0ADQGI.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],fe=le("CalendarRange",ge),G=a=>{try{return xe(ue(a),"dd/MM/yyyy")}catch{return a}};function ls({group:a,assignment:d,workloadStats:O}){const[m,q]=c.useState(""),[o,j]=c.useState(!1),[i,_]=c.useState(null),[D,u]=c.useState(null),[P,M]=c.useState(!1),[g,R]=c.useState(O||null),{toast:n}=Q(),N=[{title:"Groups",href:"/groups"},{title:a.name,href:`/groups/${a.id}`},{title:"AI Task Assignment",href:`/groups/${a.id}/ai-tasks`}];d&&(N.splice(2,0,{title:"Assignments",href:`/groups/${a.id}/assignments`}),N.splice(3,0,{title:d.title,href:`/groups/${a.id}/assignments/${d.id}`})),c.useEffect(()=>{Y()},[]);const H=s=>{(s.ctrlKey||s.metaKey)&&s.key==="Enter"&&(s.preventDefault(),m.trim()&&!o&&$(s))},$=async s=>{if(s.preventDefault(),!m.trim()){u("Please enter a description of the assignment tasks");return}j(!0),u(null);try{const r=await A("post",`/groups/${a.id}/ai-tasks/generate`,{prompt:m,assignment_id:d?.id,_token:T()},{withCredentials:!0});if(r.error){if(u(r.error),r.auth_status===!1){n({title:"Authentication Error",description:"Please log in again to continue.",variant:"destructive"}),setTimeout(()=>{window.location.href="/login"},2e3);return}}else _(r),r.workloadStats&&R(r.workloadStats),n({title:"Success!",description:"AI has generated tasks based on your description"})}catch(r){console.error("API Error:",r);const t=r;let h="An error occurred while generating tasks";if(t.response?.status===422){const l=t.response.data;if(l.errors){const w=Object.values(l.errors)[0];h=Array.isArray(w)?w[0]:String(w)}else l.message?h=l.message:l.error&&(h=l.error);console.log("Validation error details:",l)}else t.response?.status===500?(h="The server encountered an error processing your request. This might be due to the AI service being unavailable or overloaded. Please try again later.",console.error("Server error details:",t.response?.data)):h=t.response?.data?.error||"An error occurred while generating tasks";if(u(h),t.response?.status===401){n({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),setTimeout(()=>{window.location.href="/login"},2e3);return}else n({title:"Error",description:"Failed to generate tasks. Please try again.",variant:"destructive"})}finally{j(!1)}},L=async()=>{if(i){j(!0);try{const s=d?`/groups/${a.id}/assignments/${d.id}/tasks/ai-create`:`/groups/${a.id}/assignments/ai-create`,r={...i,prompt:m,_token:T()},t=await A("post",s,r,{withCredentials:!0});n({title:"Success!",description:"Assignment and tasks have been saved"}),t.redirect_url&&(window.location.href=t.redirect_url)}catch(s){console.error("Save Error:",s);const r=s,t=r.response?.data?.error||"An error occurred while saving the assignment";u(t),r.response?.status===401?(n({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),setTimeout(()=>{window.location.href="/login"},2e3)):n({title:"Error",description:"Failed to save the assignment. Please try again.",variant:"destructive"})}finally{j(!1)}}},K=async()=>{if(i?.tasks){M(!0);try{const s=await A("post",`/groups/${a.id}/ai-tasks/distribute`,{tasks:i.tasks,members:a.members,_token:T()},{withCredentials:!0});s.tasks&&(_({...i,tasks:s.tasks}),s.workloadStats&&R(s.workloadStats),n({title:"Success!",description:"Tasks have been automatically distributed among team members"}))}catch(s){console.error("Distribution Error:",s),s.response?.status===401?(n({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}),setTimeout(()=>{window.location.href="/login"},2e3)):n({title:"Error",description:"Failed to redistribute tasks. Please try again.",variant:"destructive"})}finally{M(!1)}}},U=s=>{switch(s){case"high":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100";case"medium":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100";case"low":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100";default:return"bg-slate-100 text-slate-800 dark:bg-slate-900 dark:text-slate-100"}};return e.jsxs(W,{breadcrumbs:N,children:[e.jsx(V,{title:"AI Task Assignment"}),e.jsxs(f.div,{className:"space-y-6 p-4",variants:ne,initial:"hidden",animate:"visible",children:[e.jsx(f.div,{className:"flex justify-between items-center",variants:v,children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 dark:from-primary-400 dark:to-neon-green bg-clip-text text-transparent",children:"AI Task Assignment"}),e.jsx("p",{className:"text-muted-foreground",children:"Let AI help you create and distribute tasks"})]})}),e.jsx(f.div,{variants:v,children:e.jsxs(ie,{children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary-500 dark:text-neon-green"}),d?"Add AI-Generated Tasks to Assignment":"Create New Assignment with AI"]}),e.jsx(E,{children:"Describe the assignment and tasks in detail. The AI will generate structured tasks based on your description and distribute them among team members."})]}),e.jsxs(y,{children:[e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{placeholder:`You are an expert educator and task designer. Create a structured, student-friendly assignment based on the following inputs:

Topic: [Insert topic]
Subject: [Insert subject]
Grade/Level: [Insert level]
Assignment Type: [Insert type]
Learning Outcome/Objective: [Describe the main goal]
Word Count/Length Limit: [e.g., 300â€“500 words]
Deadline: [Optional, for time-based task breakdowns]

Create an Assignment Title, Introduction, Student Instructions, Task Breakdown, Assessment Criteria, and Optional Resources.`,value:m,onChange:s=>q(s.target.value),className:"h-64",onKeyDown:H}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Be specific about what the assignment entails, including requirements, format, learning objectives, and any other relevant details."}),e.jsxs("p",{className:"text-sm text-primary-600 dark:text-primary-400 font-medium",children:["Press ",e.jsx("kbd",{className:"px-1.5 py-0.5 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-200 rounded-md dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600",children:"Ctrl+Enter"})," to submit"]})]})]}),D&&e.jsxs(X,{variant:"destructive",children:[e.jsx(Z,{children:"Error"}),e.jsx(ee,{children:D})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{type:"submit",disabled:o||!m.trim(),className:"bg-primary-500 hover:bg-primary-600 dark:bg-neon-green/80 dark:hover:bg-neon-green text-white",children:o?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Generate"}),e.jsx("span",{className:"ml-1 text-xs opacity-80",children:"(Ctrl+Enter)"})]})})})]}),o&&e.jsxs("div",{className:"mt-4 p-4 bg-primary-50 dark:bg-primary-900/20 rounded-md flex items-center",children:[e.jsx("div",{className:"mr-3",children:e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-primary-500 border-t-transparent animate-spin"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary-700 dark:text-primary-300",children:"Processing your request"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This may take up to 30 seconds depending on the complexity of your prompt..."})]})]})]})]})}),i&&e.jsxs(f.div,{variants:v,className:"space-y-6",children:[e.jsxs(I,{children:[e.jsxs(C,{children:[e.jsx(S,{children:i.assignment.title}),e.jsx(E,{children:i.assignment.unit_name})]}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.assignment.description})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Due: ",G(i.assignment.due_date)]})]})})]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Generated Tasks"}),e.jsxs(b,{variant:"outline",size:"sm",onClick:K,disabled:P,children:[P?e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Redistribute Tasks"]})]}),e.jsx(I,{children:e.jsx(y,{className:"p-0",children:e.jsxs(se,{children:[e.jsx(re,{children:e.jsxs(F,{children:[e.jsx(p,{children:"Task"}),e.jsx(p,{children:"Assigned To"}),e.jsx(p,{children:"Due Date"}),e.jsx(p,{children:"Priority"}),e.jsx(p,{children:"Effort"}),e.jsx(p,{children:"Importance"})]})}),e.jsx(te,{children:i.tasks.map((s,r)=>e.jsxs(F,{children:[e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]})}),e.jsx(x,{children:s.assigned_to_name||s.assigned_user_id&&a.members.find(t=>t.id===s.assigned_user_id)?.name||"Unassigned"}),e.jsx(x,{children:G(s.end_date)}),e.jsx(x,{children:e.jsx(B,{className:U(s.priority),children:s.priority})}),e.jsxs(x,{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:[s.effort_hours,"h"]})]}),e.jsxs(x,{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:[s.importance,"/5"]})]})]},r))})]})})})]}),g&&g.distribution.length>0&&e.jsx(f.div,{variants:v,children:e.jsxs(I,{children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-primary"}),"Member Workload Preview"]}),e.jsxs(E,{children:["This shows how workload would be distributed if these tasks are saved.",e.jsx("span",{className:"text-amber-500 font-medium block mt-1",children:'Note: Tasks are not saved until you click "Save Assignment"'})]})]}),e.jsx(y,{children:e.jsx("div",{className:"space-y-6",children:g.distribution.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-medium",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.taskCount," tasks"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[s.percentage.toFixed(1),"%"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total Effort: ",s.totalEffort," hours"]})]})]}),e.jsx(ae,{value:s.percentage,className:"h-2"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{children:"Task Details:"}),e.jsxs("p",{children:["Total Effort: ",s.totalEffort," hours"]}),e.jsxs("p",{children:["Importance Score: ",s.totalImportance]}),e.jsx("div",{className:"mt-1",children:s.tasks.map((r,t)=>e.jsx(B,{variant:"outline",className:"mr-1 mb-1",children:r.title},t))})]})]},s.id))})}),i&&e.jsx(z,{className:"flex justify-end p-4 pt-0",children:e.jsx(b,{onClick:L,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Assignment"})})]})}),i&&(!g||!g.distribution.length)&&e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(b,{onClick:L,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Assignment"})})]})]})}export{ls as default};
