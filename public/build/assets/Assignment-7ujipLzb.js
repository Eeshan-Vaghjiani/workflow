import{r as i,a as h,j as s,$ as W}from"./app-Cz-XC9l4.js";import{A as J}from"./app-layout-DBbC1wJO.js";import{P as z}from"./progress-1_i0ocS1.js";import{B as K}from"./badge-DxpFCqhw.js";import{S as x}from"./skeleton-BghLGvcu.js";import{A as q,a as F,b as R}from"./alert-C0ieycFd.js";import{G as w}from"./glass-container-qPlEyThK.js";import{E as v}from"./enhanced-button-eDxsqJ_V.js";import{c as Y,i as g}from"./theme-constants-DVo_7dxB.js";import{m as l}from"./proxy-DUnCzY_P.js";import{L}from"./log-in-O_AEqX-d.js";import{A}from"./index-B0-ktvjH.js";import{C as Q}from"./circle-alert-DaK2Z9wZ.js";import{T as Z}from"./triangle-alert-DdVqfjlP.js";import{R as M}from"./refresh-cw-CvPiLkiZ.js";import{c as G}from"./createLucideIcon-CfQhLZuM.js";import{U as I}from"./users-Da4X3jqK.js";import{B as U}from"./button-Diu-54fO.js";import{A as ss}from"./arrow-left-DOU4YIXA.js";import{P as es}from"./plus-ax70JYGI.js";import"./app-sidebar-layout-BnpPf58W.js";import"./index-MaZke14b.js";import"./index-BUtF6_nR.js";import"./utils-CBfrqCZ4.js";import"./input-gyYvXWbp.js";import"./dropdown-menu-CMVoGVyb.js";import"./index-B_RcF4Vj.js";import"./index-BlXtbhPC.js";import"./index-BtsonFn7.js";import"./avatar-DLZPR9xF.js";import"./index-CmyQNJFQ.js";import"./use-animation-CJs_orTr.js";import"./use-animation-CBeboh00.js";import"./chevron-right-BnGLYIXb.js";import"./square-check-big-Dvy61Sch.js";import"./calendar-Cz-eKFtz.js";import"./credit-card-CsbvY-q-.js";import"./user-ILuj1RD-.js";import"./use-appearance-rE9bUEXS.js";import"./sun-C2hnd78D.js";import"./settings-DpzlEckF.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]],as=G("ChartNoAxesColumnIncreasing",ts);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M17 12h-2l-2 5-2-10-2 5H7",key:"15hlnc"}]],B=G("SquareActivity",is);function rs({groupId:r,assignmentId:o,onAssignmentChange:m}){const[f,y]=i.useState(!0),[c,j]=i.useState(!1),[T,a]=i.useState(null),[k,n]=i.useState(null),[p,S]=i.useState([]),[d,X]=i.useState([]),[C,E]=i.useState([]),[$,D]=i.useState(!1),[N,H]=i.useState(0),[V,u]=i.useState(!1);i.useEffect(()=>{O()},[r,o]),i.useEffect(()=>{d.length>0&&console.debug(`Group has ${d.length} members available for task assignment`)},[d]);const P=async()=>{try{const t=await h.get("/auth/status");return t.data.authenticated?(console.log("User authenticated:",t.data.user?.name),!0):(console.log("Not authenticated, trying to refresh session..."),await h.get("/auth/refresh-session"),(await h.get("/auth/status")).data.authenticated)}catch(t){return console.error("Authentication check failed:",t),!1}},O=async()=>{try{if(y(!0),a(null),n(null),u(!1),!await P()){u(!0),a("Authentication required. Please log in and try again."),y(!1);return}console.log("Using direct web route for task stats");const e=await h.get(`/groups/${r}/assignments/${o}/get-stats`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});e?.data?.success?(S(e.data.tasks),X(e.data.groupMembers),E(e.data.workloadDistribution),D(e.data.hasUnassignedTasks),e.data.invalidAssignmentsFixed>0&&H(e.data.invalidAssignmentsFixed)):e?.data?(a(e.data.error||"Failed to fetch assignment statistics"),e.data.error_details&&n(e.data.error_details)):a("Failed to fetch assignment statistics. No valid response received.")}catch(t){console.error("Error fetching assignment stats:",t);const e=t;if(console.error("Error details:",e.response?.data),e.response?.status===401)u(!0),a("Authentication required. Please log in and try again.");else{const b=e.response?.data?.error||"Failed to load task assignments. Please try again.";a(b),e.response?.data?.error_details?n(e.response.data.error_details):e.response?.data&&n([{message:JSON.stringify(e.response.data,null,2)}])}}finally{y(!1)}},_=async()=>{try{if(j(!0),a(null),n(null),!await P()){u(!0),a("Authentication required. Please log in and try again."),j(!1);return}console.log("Starting task distribution...");const e=await h.post(`/groups/${r}/assignments/${o}/distribute-tasks`,{},{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},withCredentials:!0});console.log("Distribution response:",e.data),e?.data?.success?(S(e.data.tasks),E(e.data.workloadDistribution),D(!1),e.data.stats&&e.data.stats.errors>0&&(n(e.data.stats.error_details||[]),a(`Task distribution completed with ${e.data.stats.errors} errors. Some tasks may not be assigned correctly.`)),m&&m()):e?.data?(a(e.data.error||"Failed to distribute tasks"),e.data.error_details&&n(e.data.error_details)):a("Failed to distribute tasks. No valid response received.")}catch(t){console.error("Error distributing tasks:",t);const e=t;console.error("Error response:",e.response?.data);const b=e.response?.data?.error||"Failed to distribute tasks. Please try again.";a(b),e.response?.data?.error_details?n(e.response.data.error_details):e.response?.data&&n([{message:JSON.stringify(e.response.data,null,2)}])}finally{j(!1)}};return f?s.jsx(l.div,{className:"space-y-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:s.jsxs(w,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{children:[s.jsx(x,{className:"h-8 w-64"}),s.jsx(x,{className:"h-4 w-40 mt-2"})]}),s.jsx(x,{className:"h-10 w-36"})]}),s.jsx("div",{className:"space-y-4",children:Array(3).fill(0).map((t,e)=>s.jsx(x,{className:"h-20 w-full"},e))})]})}):V?s.jsx(l.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:300,damping:25},children:s.jsx(w,{className:"p-6",children:s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[s.jsx(l.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2},className:"mb-6",children:s.jsx(L,{className:"h-16 w-16 text-red-500 mx-auto"})}),s.jsx("h2",{className:"text-xl font-bold mb-2",children:"Authentication Required"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6 max-w-md",children:"Your session may have expired. Please log in again to view and manage task assignments."}),s.jsx(v,{onClick:()=>window.location.href="/login",icon:s.jsx(L,{className:"h-4 w-4 mr-2"}),iconPosition:"left",children:"Log In"})]})})}):s.jsxs(l.div,{className:"space-y-6",variants:Y,initial:"hidden",animate:"visible",children:[s.jsx(A,{children:T&&s.jsxs(l.div,{variants:g,initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{type:"spring",stiffness:300,damping:25},children:[s.jsxs(q,{variant:"destructive",children:[s.jsx(Q,{className:"h-4 w-4"}),s.jsx(F,{children:"Error"}),s.jsx(R,{children:T})]}),k&&k.length>0&&s.jsx("div",{className:"mt-2 bg-red-50 dark:bg-red-900/20 p-3 rounded-md text-sm",children:s.jsxs("details",{children:[s.jsx("summary",{className:"font-medium cursor-pointer",children:"View error details"}),s.jsx("ul",{className:"mt-2 list-disc pl-5 space-y-1",children:k.map((t,e)=>s.jsxs("li",{children:[t.task_id&&s.jsxs("span",{className:"font-mono",children:["Task #",t.task_id,": "]}),t.message]},e))})]})})]})}),s.jsx(A,{children:N>0&&s.jsx(l.div,{variants:g,initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{type:"spring",stiffness:300,damping:25},children:s.jsxs(q,{children:[s.jsx(Z,{className:"h-4 w-4"}),s.jsx(F,{children:"Notice"}),s.jsxs(R,{children:[N," task",N>1?"s were":" was"," assigned to users who are no longer in the group. These assignments have been automatically cleared."]})]})})}),s.jsx(l.div,{variants:g,children:s.jsxs(w,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold",children:"Task Distribution"}),s.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:[p.length," task",p.length!==1?"s":""," across ",d.length," group member",d.length!==1?"s":""]})]}),s.jsx(v,{onClick:_,disabled:c||p.length===0||d.length===0,className:"flex items-center gap-2",icon:s.jsx(M,{className:`h-4 w-4 ${c?"animate-spin":""}`}),iconPosition:"left",children:c?"Distributing...":"Auto-Distribute Tasks"})]}),C.length>0?s.jsx("div",{className:"space-y-6",children:s.jsx(A,{children:C.map(t=>s.jsxs(l.div,{variants:g,className:"bg-white/10 dark:bg-gray-800/20 backdrop-blur-sm rounded-lg p-4 border border-white/10 dark:border-gray-700/50",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:t.name}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(B,{className:"h-3.5 w-3.5"}),t.taskCount," task",t.taskCount!==1?"s":""]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(as,{className:"h-3.5 w-3.5"}),t.totalEffort," hours"]})]})]}),s.jsxs(K,{className:`${t.percentage>40?"bg-green-500":t.percentage>20?"bg-yellow-500":"bg-red-500"}`,children:[t.percentage.toFixed(1),"% workload"]})]}),s.jsx(z,{value:t.percentage,className:"h-2 mt-2"}),t.tasks.length>0&&s.jsx("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:t.tasks.map(e=>s.jsxs("div",{className:"flex justify-between items-center p-2 bg-white/5 dark:bg-gray-900/20 rounded",children:[s.jsx("span",{className:"truncate",children:e.title}),s.jsxs("span",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-1 whitespace-nowrap",children:[s.jsx(B,{className:"h-3 w-3"})," ",e.effort,"h"]})]},e.id))})]},t.id))})}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(I,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),s.jsx("h3",{className:"text-lg font-medium mb-2",children:"No task distribution data"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:$?"There are unassigned tasks. Click 'Auto-Distribute Tasks' to assign them.":p.length===0?"No tasks have been created for this assignment yet.":"Tasks exist but no workload data is available."}),$&&s.jsx(v,{onClick:_,disabled:c,icon:s.jsx(M,{className:`h-4 w-4 ${c?"animate-spin":""}`}),iconPosition:"left",children:c?"Distributing...":"Auto-Distribute Tasks"})]})]})})]})}function Js({groupId:r,assignmentId:o,assignment:m}){const f=[{title:"Groups",href:"/groups"},{title:"Assignments",href:`/groups/${r}/assignments`},{title:m.title,href:`/groups/${r}/assignments/${o}`},{title:"Task Assignments",href:`/groups/${r}/assignments/${o}/task-assignments`}];return s.jsxs(J,{breadcrumbs:f,children:[s.jsx(W,{title:"Task Assignments"}),s.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 p-4",children:[s.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold",children:[m.title," - Task Assignments"]}),s.jsx("p",{className:"text-gray-500",children:"View and manage task assignments for this assignment"})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs(U,{variant:"outline",className:"flex items-center gap-2",onClick:()=>window.history.back(),children:[s.jsx(ss,{className:"h-4 w-4"}),"Back"]}),s.jsxs(U,{className:"flex items-center gap-2",onClick:()=>window.location.href=route("group-tasks.create",{group:r,assignment:o}),children:[s.jsx(es,{className:"h-4 w-4"}),"Add Task"]})]})]}),s.jsx(rs,{groupId:r,assignmentId:o,onAssignmentChange:()=>{}})]})]})}export{Js as default};
