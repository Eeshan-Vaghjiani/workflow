import{r as i,j as e,$ as b}from"./app-Bpl7UGUW.js";import{A as f}from"./app-layout-BVbkYQEz.js";import{C as y}from"./card-3d-CcLzNSxw.js";import{G as k}from"./glass-container-CJ4c02pk.js";import{c as N,i as c}from"./theme-constants-DVo_7dxB.js";import{m as o}from"./proxy-BZsCD5Dk.js";import"./app-sidebar-layout-3CLlJw7C.js";import"./index-D71eR4x0.js";import"./index-DktHM2-i.js";import"./button-nI1-8HXs.js";import"./utils-CBfrqCZ4.js";import"./input-CQiJ7d6K.js";import"./dropdown-menu-fbT6E9Fk.js";import"./index-DH-cxLSN.js";import"./index-CMRx08MW.js";import"./index-Ct9M_J9d.js";import"./avatar-B2MfT7TY.js";import"./index-DNoKO7hz.js";import"./createLucideIcon-rZimPHd5.js";import"./use-animation-l8PqFNwu.js";import"./use-animation-B-tVBdbv.js";import"./chevron-right-DNIHTrhx.js";import"./users-UITC1FaJ.js";import"./square-check-big-B0Q9VKGE.js";import"./calendar-BpKIoVUT.js";import"./credit-card-DNKN2izi.js";import"./user-CnsbQcIt.js";import"./use-appearance-DBkYCLhm.js";import"./sun-Bv7wBj0o.js";import"./settings-GAq3FU_8.js";import"./index-BO9oOdSc.js";function v(){const[t,p]=i.useState(null),[d,h]=i.useState(!1),[u,m]=i.useState(null),[s,n]=i.useState(null);async function x(){h(!0),m(null);try{const a=await(await fetch("/api/auth-status",{method:"GET",headers:{Accept:"application/json"},credentials:"include"})).json();p(a)}catch(r){m(r.message||"Error checking authentication status"),console.error("Auth check error:",r)}finally{h(!1)}}async function g(){try{await fetch("/sanctum/csrf-cookie",{method:"GET",credentials:"include"}),alert("CSRF cookie refreshed. Try your request again.")}catch(r){console.error("Error refreshing CSRF token",r),alert("Failed to refresh CSRF token.")}}async function j(){try{n({loading:!0}),await fetch("/sanctum/csrf-cookie",{method:"GET",credentials:"include"});const a=await fetch("/api/groups/5/ai/tasks",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({prompt:"Test AI endpoint with a basic task"})});if(a.ok){const l=await a.json();n({success:!0,status:a.status,data:l})}else{const l=await a.text();n({success:!1,status:a.status,error:l})}}catch(r){n({success:!1,error:r.message||"Unknown error occurred"})}}return i.useEffect(()=>{x()},[]),e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Authentication Debugger"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:x,disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:d?"Checking...":"Check Auth Status"}),e.jsx("button",{onClick:g,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Refresh CSRF Cookie"}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",disabled:s?.loading,children:s?.loading?"Testing...":"Test AI Tasks Endpoint"})]}),u&&e.jsxs("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:["Error: ",u]}),s&&!s.loading&&e.jsxs("div",{className:`p-4 ${s.success?"bg-green-100 text-green-700":"bg-red-100 text-red-700"} rounded-md mt-4`,children:[e.jsxs("h3",{className:"font-medium",children:["AI Endpoint Test: ",s.success?"Success":"Failed"]}),s.status&&e.jsxs("p",{children:["Status code: ",s.status]}),s.error&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{children:"Error:"}),e.jsx("pre",{className:"text-sm bg-red-50 p-2 rounded mt-1 overflow-auto max-h-40",children:s.error})]}),s.data&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{children:"Response data:"}),e.jsx("pre",{className:"text-sm bg-green-50 p-2 rounded mt-1 overflow-auto max-h-40",children:JSON.stringify(s.data,null,2)})]}),!s.success&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium",children:"Suggested fixes:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-1",children:[e.jsxs("li",{className:"text-sm",children:["Make sure you're logged in (",e.jsx("a",{href:"/login",className:"underline",children:"go to login"}),")"]}),e.jsx("li",{className:"text-sm",children:"Clear your browser cookies and try again"}),e.jsxs("li",{className:"text-sm",children:["Try the no-auth version at ",e.jsx("a",{href:"/ai-test",className:"underline",children:"/ai-test"})]}),e.jsx("li",{className:"text-sm",children:"Check that your API routes are configured correctly"})]})]})]}),t&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Status: ",t.authenticated?e.jsx("span",{className:"text-green-600",children:"Authenticated"}):e.jsx("span",{className:"text-red-600",children:"Not Authenticated"})]}),t.authenticated&&t.user&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium",children:"User Info:"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-2 rounded-md mt-2",children:e.jsx("pre",{className:"text-sm",children:JSON.stringify(t.user,null,2)})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium",children:"Session Info:"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-2 rounded-md mt-2",children:e.jsx("pre",{className:"text-sm",children:JSON.stringify(t.session,null,2)})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium",children:"Headers:"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-2 rounded-md mt-2",children:e.jsx("pre",{className:"text-sm",children:JSON.stringify(t.headers,null,2)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Cookies:"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-2 rounded-md mt-2",children:e.jsx("pre",{className:"text-sm",children:Object.keys(t.cookies||{}).length>0?JSON.stringify(t.cookies,null,2):"No cookies found"})})]})]}),e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsx("h3",{className:"font-semibold",children:"Common Authentication Issues:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-2 space-y-1 text-sm",children:[e.jsx("li",{children:"Missing or expired CSRF token"}),e.jsx("li",{children:"Session cookie not being sent with the request"}),e.jsx("li",{children:"CORS issues preventing cookies from being sent"}),e.jsx("li",{children:"SPA and API running on different domains"}),e.jsx("li",{children:"Missing 'credentials: include' in fetch/axios requests"}),e.jsx("li",{children:"Session has expired and user needs to re-login"})]})]})]})]})}function se(){const t=[{title:"Authentication Debug",href:"/auth-debug"}];return e.jsxs(f,{breadcrumbs:t,children:[e.jsx(b,{title:"Authentication Debugger"}),e.jsxs(o.div,{className:"flex h-full flex-1 flex-col gap-6 p-6",variants:N,initial:"hidden",animate:"visible",children:[e.jsxs(o.div,{variants:c,className:"mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Authentication Debugger"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Use this tool to diagnose authentication issues"})]}),e.jsx(o.div,{variants:c,children:e.jsx(y,{className:"p-6",children:e.jsx(v,{})})}),e.jsx(o.div,{variants:c,children:e.jsxs(k,{className:"p-6",blurIntensity:"sm",hoverEffect:!0,children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"Authentication Troubleshooting Guide"}),e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("h3",{className:"text-primary-500 dark:text-neon-green",children:"1. Check Your Login Status"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:'First, make sure you are properly logged in. If the authentication debugger shows "Not Authenticated", try logging in again.'}),e.jsx("h3",{className:"text-primary-500 dark:text-neon-green",children:"2. CSRF Token Issues"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:'Laravel uses CSRF tokens to prevent cross-site request forgery. If your requests are failing with 419 errors, you might need to refresh your CSRF token using the "Refresh CSRF Cookie" button.'}),e.jsx("h3",{className:"text-primary-500 dark:text-neon-green",children:"3. Session Cookie Problems"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["For Sanctum authentication to work properly, your browser needs to send the session cookie with API requests. Make sure your requests include ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"credentials: 'include'"})," and that the session cookie is present in the debugger's cookie list."]}),e.jsx("h3",{className:"text-primary-500 dark:text-neon-green",children:"4. Testing API Endpoints"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"You can test various API endpoints to check authentication:"}),e.jsxs("ul",{className:"space-y-2 text-gray-600 dark:text-gray-300",children:[e.jsxs("li",{children:[e.jsx("a",{href:"/api/auth-check",target:"_blank",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 transition-colors",children:"/api/auth-check"})," - Should always work (no auth required)"]}),e.jsxs("li",{children:[e.jsx("a",{href:"/api/auth-status",target:"_blank",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 transition-colors",children:"/api/auth-status"})," - Shows detailed auth information"]}),e.jsxs("li",{children:[e.jsx("a",{href:"/api/user",target:"_blank",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 transition-colors",children:"/api/user"})," - Should show user data if authenticated"]})]}),e.jsx("h3",{className:"text-primary-500 dark:text-neon-green",children:"5. Browser Console"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Check your browser's developer tools console for additional error messages that might help identify the problem."})]})]})})]})]})}export{se as default};
