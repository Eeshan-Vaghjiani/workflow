import{r as p,j as t,$ as I,Y as z,a as N}from"./app-Bpl7UGUW.js";import{A as L}from"./app-layout-BVbkYQEz.js";import{F as _,i as $,a as O,b as V}from"./index-D7JuqhKK.js";import{e as q,a as H,b as U,c as W}from"./card-CzKFM-Bc.js";import{E as g}from"./enhanced-button-CoxoAF_G.js";import{u as X}from"./use-toast-DAyflqjm.js";import{c as Y}from"./utils-CBfrqCZ4.js";import{m}from"./proxy-BZsCD5Dk.js";import{R as K}from"./refresh-cw-CPmgjJlL.js";import{C as B}from"./calendar-BpKIoVUT.js";import{S as J}from"./settings-GAq3FU_8.js";import{T as Q}from"./triangle-alert-MqoSkCv0.js";import"./app-sidebar-layout-3CLlJw7C.js";import"./index-D71eR4x0.js";import"./index-DktHM2-i.js";import"./button-nI1-8HXs.js";import"./input-CQiJ7d6K.js";import"./dropdown-menu-fbT6E9Fk.js";import"./index-DH-cxLSN.js";import"./index-CMRx08MW.js";import"./index-Ct9M_J9d.js";import"./avatar-B2MfT7TY.js";import"./index-DNoKO7hz.js";import"./createLucideIcon-rZimPHd5.js";import"./use-animation-l8PqFNwu.js";import"./use-animation-B-tVBdbv.js";import"./chevron-right-DNIHTrhx.js";import"./users-UITC1FaJ.js";import"./square-check-big-B0Q9VKGE.js";import"./credit-card-DNKN2izi.js";import"./user-CnsbQcIt.js";import"./use-appearance-DBkYCLhm.js";import"./sun-Bv7wBj0o.js";import"./glass-container-CJ4c02pk.js";import"./index-BO9oOdSc.js";const E={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,when:"beforeChildren"}}},Z={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:100,damping:15}}},ee=[{title:"Dashboard",href:"/dashboard"},{title:"Calendar",href:"/dashboard/calendar"}];function ze({events:S}){const[r,o]=p.useState(null),[y,v]=p.useState(!1),{toast:d}=X(),P=p.useRef(null),[D,x]=p.useState(S),j=e=>({id:String(e.id),title:e.title,start:e.start_date,end:e.end_date||e.due_date,allDay:!0,backgroundColor:b(e.priority),borderColor:b(e.priority),textColor:"#ffffff",extendedProps:{group:e.group||"Unknown",priority:e.priority||"medium",status:e.status||"pending",assignment:e.assignment?.title,type:"task"}}),b=e=>{switch(e){case"high":return"#ef4444";case"medium":return"#f59e0b";case"low":return"#10b981";default:return"#6b7280"}},T=D.map(e=>{const s=new Date;return new Date(e.end)<s&&(!e.extendedProps.status||e.extendedProps.status!=="completed")?{...e,backgroundColor:"#ef4444",borderColor:"#ef4444",textColor:"#ffffff",classNames:["past-due-event"],extendedProps:{...e.extendedProps,isPastDue:!0}}:e}),M=e=>{e.event.url||e.jsEvent.preventDefault(),o(e.event)},F=e=>{o(e.event)},R=()=>{o(null)},w=async e=>{const{event:s}=e,l=s.id,c=s.start?new Date(s.start).toISOString().split("T")[0]:null,f=s.end?new Date(s.end).toISOString().split("T")[0]:c;if(!c){console.error("Invalid start date"),e.revert();return}try{const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!a){console.error("CSRF token not found"),d({title:"Authentication Error",description:"Please refresh the page and try again.",variant:"destructive"}),e.revert();return}const i={start_date:c,end_date:f,due_date:f,title:s.title,...s.extendedProps||{},status:s.extendedProps?.status||"pending",priority:s.extendedProps?.priority||"medium"};console.log("Updating task with payload:",i,"for task ID:",l);const n=await N.put(`/tasks/${l}`,i,{headers:{"X-CSRF-TOKEN":a,"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},withCredentials:!0});if(console.info("Task update response:",n.data),n.data.success===!0||n.data.message&&n.data.message.includes("Task updated successfully")){if(n.data.task){const h=j(n.data.task);x(u=>u.map(k=>k.id===l?h:k)),console.info("UI state successfully updated with server response.")}else x(h=>h.map(u=>u.id===l?{...u,start:c,end:f||c}:u));const G=n.data.google_sync?"Task dates updated and synced with Google Calendar.":"Task dates updated successfully.";d({title:"Event Updated",description:G})}else throw console.warn("Task update returned success: false",n.data),e.revert(),new Error(n.data.message||"Failed to update task")}catch(a){console.error("Error updating event:",a),e.revert();let i="Failed to update task dates. Please try again.";a.response&&(console.error("Error response data:",a.response.data),a.response.status===401?i="You need to be logged in to update tasks. Please refresh the page.":a.response.status===403?i="You don't have permission to update this task.":a.response.status===422&&(i="Validation error: "+(a.response.data?.errors?Object.values(a.response.data.errors).flat().join(", "):a.response.data.message||"Please check your input"))),d({title:"Error",description:i,variant:"destructive"})}},C=e=>e?new Intl.DateTimeFormat("default",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(e):"N/A",A=async()=>{try{v(!0);const e=await N.post("/calendar/sync",{},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(e.data.success){if(d({title:"Sync Successful",description:"Calendar synchronized with Google Calendar",variant:"default"}),e.data.events){const s=e.data.events.map(j);x(s)}}else throw new Error(e.data.message||"Sync failed")}catch(e){console.error("Error during sync:",e),d({title:"Sync Failed",description:e.response?.data?.message||e.message||"Failed to sync with Google Calendar",variant:"destructive"})}finally{v(!1)}};return t.jsxs(L,{breadcrumbs:ee,children:[t.jsx(I,{title:"Calendar"}),t.jsx(m.div,{className:"flex h-full flex-1 flex-col gap-6 p-6",variants:E,initial:"hidden",animate:"visible",children:t.jsxs(m.div,{className:"grid grid-cols-1 gap-6",variants:E,children:[t.jsx(m.div,{className:"col-span-1",variants:Z,children:t.jsxs(q,{className:"bg-background",children:[t.jsxs("div",{className:"flex flex-row items-center justify-between p-6",children:[t.jsxs("div",{children:[t.jsx(H,{className:"text-2xl font-semibold text-foreground",children:"Calendar"}),t.jsx(U,{children:"View and manage your tasks and assignments"})]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx(g,{onClick:A,disabled:y,variant:"secondary",size:"sm",icon:y?t.jsx(K,{className:"h-4 w-4 animate-spin"}):t.jsx(B,{className:"h-4 w-4"}),iconPosition:"left",magnetic:!0,children:"Sync with Google"}),t.jsx(z,{href:route("calendar.settings"),children:t.jsx(g,{variant:"outline",size:"sm",icon:t.jsx(J,{className:"h-4 w-4"}),iconPosition:"left",magnetic:!0,children:"Settings"})})]})]}),t.jsx(W,{className:"p-0",children:t.jsx("div",{className:Y("calendar-container","dark:bg-background dark:text-foreground","border-t border-border"),children:t.jsx(_,{ref:P,plugins:[$,O,V],initialView:"dayGridMonth",events:T,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,eventClick:M,eventMouseEnter:F,eventMouseLeave:R,eventDrop:w,eventResize:w,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},buttonText:{today:"Today",month:"Month",week:"Week",day:"Day"},themeSystem:"standard",height:"auto",contentHeight:"auto",aspectRatio:2,expandRows:!0,stickyHeaderDates:!0,nowIndicator:!0,dayHeaders:!0,eventDisplay:"block",eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},slotLabelFormat:{hour:"numeric",minute:"2-digit",hour12:!0},allDaySlot:!0,allDayText:"All Day",slotMinTime:"06:00:00",slotMaxTime:"22:00:00",slotDuration:"00:30:00",slotLabelInterval:"01:00"})})})]})}),r&&t.jsx(m.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>o(null),children:t.jsxs(m.div,{className:"mx-4 w-full max-w-md rounded-lg bg-background p-6 shadow-xl",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-foreground",children:r.title}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:[C(r.start)," - ",C(r.end)]})]}),r.extendedProps.isPastDue&&t.jsxs("div",{className:"flex items-center text-destructive",children:[t.jsx(Q,{className:"mr-1 h-4 w-4"}),t.jsx("span",{className:"text-sm",children:"Past Due"})]})]}),t.jsxs("div",{className:"space-y-3",children:[r.extendedProps.assignment&&t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-foreground",children:"Assignment"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:r.extendedProps.assignment})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-foreground",children:"Group"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:r.extendedProps.group})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-foreground",children:"Priority"}),t.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:r.extendedProps.priority})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-foreground",children:"Status"}),t.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:r.extendedProps.status})]})]}),t.jsx("div",{className:"mt-6 flex justify-end",children:t.jsx(g,{onClick:()=>o(null),variant:"outline",size:"sm",magnetic:!0,children:"Close"})})]})})]})})]})}export{ze as default};
