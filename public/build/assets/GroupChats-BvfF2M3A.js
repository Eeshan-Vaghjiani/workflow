import{r as l,j as e,a as j}from"./app-EFdNlzF1.js";import{A as y,a as p,b}from"./avatar-DTxGSWKN.js";import{B}from"./button-CasVOQbR.js";import{I as G}from"./input-Bk2B3GPX.js";import{S as L}from"./scroll-area-CZnOwY_f.js";import{u as P}from"./use-toast-CANIoCn8.js";import{S as R}from"./search-CVggSWwQ.js";import{U as v}from"./users-BhyyQbJ9.js";import"./index-DZoa35Y7.js";import"./index-c1zC8zW2.js";import"./index-z8h15STC.js";import"./index-B4gP1Yw4.js";import"./utils-CBfrqCZ4.js";import"./index-BdQq_4o_.js";import"./createLucideIcon-Ci57Z1nb.js";function Z({currentUserId:i}){const[N,w]=l.useState([]),[t,k]=l.useState(null),[d,x]=l.useState([]),[c,S]=l.useState(""),[_,m]=l.useState(!0),[A,h]=l.useState(!1),[o,f]=l.useState(!1),[u,E]=l.useState(""),{toast:n}=P(),M=l.useRef(null);l.useEffect(()=>{(async()=>{try{m(!0);const r=await j.get("/chat/groups");w(r.data),m(!1)}catch(r){console.error("Error fetching groups:",r),m(!1),n({title:"Error",description:"Failed to load groups. Please try again.",variant:"destructive"})}})()},[n]),l.useEffect(()=>{if(t){(async()=>{try{h(!0);const a=await j.get(`/chat/group/${t.id}`);x(a.data.messages||[]),k({...t,...a.data}),h(!1)}catch(a){console.error("Error fetching group messages:",a),h(!1),n({title:"Error",description:"Failed to load group messages. Please try again.",variant:"destructive"})}})();const r=window.Echo.join(`group.${t.id}`);return r.listen(".group.message",a=>{d.some(g=>g.id===a.id)||x(g=>[...g,a])}),r.here(a=>{console.log("Users currently in the channel:",a)}),r.joining(a=>{console.log("User joined:",a)}),r.leaving(a=>{console.log("User left:",a)}),()=>{r.stopListening(".group.message"),window.Echo.leave(`group.${t.id}`)}}},[t,d,n]),l.useEffect(()=>{M.current?.scrollIntoView({behavior:"smooth"})},[d,t,n]);const F=s=>{k(s),E("")},C=async()=>{if(!(!c.trim()||!t||o))try{f(!0);const s=await j.post(`/chat/group/${t.id}`,{message:c});x(r=>[...r,s.data]),S(""),w(r=>r.map(a=>a.id===t.id?{...a,lastMessage:{content:c,timestamp:s.data.timestamp,date:s.data.date,sender:"You"}}:a)),f(!1)}catch(s){console.error("Error sending message:",s),f(!1),n({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}},$=u?N.filter(s=>s.name.toLowerCase().includes(u.toLowerCase())):N;return e.jsxs("div",{className:"flex h-full flex-col md:flex-row",children:[e.jsx("div",{className:"h-1/3 w-full border-b border-r border-gray-200 md:h-full md:w-80 md:flex-shrink-0 dark:border-gray-700",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500 dark:text-gray-400"}),e.jsx(G,{placeholder:"Search groups...",className:"pl-8",value:u,onChange:s=>E(s.target.value)})]})}),e.jsx(L,{className:"flex-1",children:_?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-t-2 border-gray-500"})}):$.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"You're not in any groups yet"}),e.jsx("p",{children:"Join or create a group to start chatting"})]}):e.jsx("div",{className:"p-2 space-y-1",children:$.map(s=>e.jsxs("button",{className:`flex w-full items-center gap-2 rounded-md p-2 ${t?.id===s.id?"bg-gray-100 dark:bg-gray-800":"hover:bg-gray-100 dark:hover:bg-gray-800"}`,onClick:()=>F(s),children:[e.jsx("div",{className:"relative",children:s.avatar?e.jsxs(y,{className:"h-10 w-10",children:[e.jsx(p,{src:s.avatar,alt:s.name}),e.jsx(b,{children:s.name.substring(0,2)})]}):e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-500 dark:bg-blue-900 dark:text-blue-300",children:e.jsx(v,{size:20})})}),e.jsxs("div",{className:"flex flex-1 flex-col items-start",children:[e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("span",{className:"font-medium",children:s.name}),s.lastMessage&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.lastMessage.timestamp})]}),e.jsxs("div",{className:"flex w-full justify-between",children:[s.lastMessage&&e.jsxs("span",{className:"truncate text-sm text-gray-500 dark:text-gray-400",children:[s.lastMessage.sender?`${s.lastMessage.sender}: `:"",s.lastMessage.content]}),(s.unreadCount||0)>0&&e.jsx("span",{className:"ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-blue-500 text-xs text-white",children:s.unreadCount})]})]})]},s.id))})})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:t?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-gray-200 p-4 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[t.avatar?e.jsxs(y,{className:"h-10 w-10",children:[e.jsx(p,{src:t.avatar,alt:t.name}),e.jsx(b,{children:t.name.substring(0,2)})]}):e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-500 dark:bg-blue-900 dark:text-blue-300",children:e.jsx(v,{size:20})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"font-semibold",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t.members?.length||t.memberCount||0," members"]})]})]})}),e.jsx(L,{className:"flex-1 p-4",children:A?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-5 w-5 animate-spin rounded-full border-t-2 border-gray-500"})}):d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("p",{children:"No messages yet"}),e.jsx("p",{children:"Be the first to send a message!"})]}):e.jsxs("div",{className:"space-y-4",children:[d.map(s=>e.jsxs("div",{className:`flex ${s.is_system_message?"justify-center":s.sender.id===i?"justify-end":"justify-start"}`,children:[s.is_system_message?e.jsx("div",{className:"my-2 rounded-md bg-gray-100 px-3 py-1 text-xs text-gray-500 dark:bg-gray-800 dark:text-gray-400",children:s.content}):s.sender.id!==i&&e.jsxs(y,{className:"mr-2 h-8 w-8 self-end",children:[e.jsx(p,{src:s.sender.avatar||"",alt:s.sender.name}),e.jsx(b,{children:s.sender.name.substring(0,2)})]}),!s.is_system_message&&e.jsxs("div",{className:`max-w-xs rounded-lg px-4 py-2 ${s.sender.id===i?"bg-blue-500 text-white":"bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-100"}`,children:[s.sender.id!==i&&e.jsx("p",{className:"mb-1 text-xs font-medium",children:s.sender.name}),e.jsx("p",{children:s.content}),e.jsx("span",{className:`mt-1 block text-xs ${s.sender.id===i?"text-blue-100":"text-gray-500 dark:text-gray-400"}`,children:s.timestamp})]})]},s.id)),e.jsx("div",{ref:M})]})}),e.jsx("div",{className:"border-t border-gray-200 p-4 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{placeholder:"Type your message...",value:c,onChange:s=>S(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),C())},disabled:o,className:"flex-1"}),e.jsx(B,{onClick:C,disabled:o||!c.trim(),children:o?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):"Send"})]})})]}):e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"mb-4 rounded-full bg-gray-100 p-6 dark:bg-gray-800",children:e.jsx(v,{className:"h-10 w-10 text-gray-500 dark:text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Select a group"}),e.jsx("p",{className:"mt-2 max-w-md text-gray-500 dark:text-gray-400",children:"Choose a group from the list to start chatting"})]})})]})}export{Z as default};
