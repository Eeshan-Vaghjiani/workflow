import{r as a,a as p,j as e,$ as X}from"./app-EFdNlzF1.js";import{B as g}from"./button-CasVOQbR.js";import{I as M}from"./input-Bk2B3GPX.js";import{e as w,C as S,a as A,b as G,c as I,d as O}from"./card-BCz-9kZc.js";import{A as E,a as D,b as F}from"./alert-BD6n4Q_B.js";import{C as U}from"./circle-alert-De98Sfo_.js";import{c as $}from"./createLucideIcon-Ci57Z1nb.js";import{L as q}from"./loader-circle-Ccdlj7r2.js";import{A as J}from"./app-layout-0nbQuyMj.js";import{C as Q}from"./card-3d-Bo48T8xr.js";import{c as Y,i as R}from"./theme-constants-DVo_7dxB.js";import{m as y}from"./proxy-CbQpuZ5T.js";import"./utils-CBfrqCZ4.js";import"./app-sidebar-layout-2N2f9zf2.js";import"./index-DZoa35Y7.js";import"./index-c1zC8zW2.js";import"./dropdown-menu-Be5dVAII.js";import"./index-W8SXwZza.js";import"./index-z8h15STC.js";import"./index-CXYmmwmY.js";import"./avatar-DTxGSWKN.js";import"./index-B4gP1Yw4.js";import"./use-animation-WpyryXH0.js";import"./use-animation-BzGI8ib-.js";import"./chevron-right-BAVANYz7.js";import"./users-BhyyQbJ9.js";import"./square-check-big-DO1D6uu6.js";import"./calendar-BAuuk18F.js";import"./credit-card-BbHoo0vm.js";import"./user-C97Zk_aQ.js";import"./use-appearance-B35erkEd.js";import"./sun-Dv7cDcCR.js";import"./settings-hZB-BaSU.js";import"./glass-container-DKPWOAO6.js";import"./index-B8-Zcyzl.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ee=$("ArrowRight",Z);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],se=$("Phone",te);p.defaults.withCredentials=!0;p.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const ae=({title:u="Pro Membership Payment",description:L="Pay your Pro Membership fee via M-Pesa"})=>{const[j,T]=a.useState(""),[P,l]=a.useState(!1),[W,N]=a.useState(!1),[K,m]=a.useState(!1),[v,o]=a.useState(""),[n,h]=a.useState(!1),[i,c]=a.useState(!1),[d,k]=a.useState(null),[x,f]=a.useState(0),[C,_]=a.useState("1000");a.useEffect(()=>{let s;return d&&!n&&!i&&x<15&&(s=setInterval(()=>{z(),f(t=>t+1)},5e3)),()=>{s&&clearInterval(s)}},[d,n,i,x]);const z=async()=>{if(d)try{const s=await p.post("/api/mpesa/check-status",{checkoutRequestId:d},{headers:{"Content-Type":"application/json",Accept:"application/json"}}),{status:t,message:r}=s.data;t==="completed"?(h(!0),o("Payment completed successfully! Thank you for upgrading to Pro Membership."),b()):t==="failed"?(c(!0),o(`Payment failed: ${r}`),b()):o("Waiting for payment confirmation...")}catch(s){console.error("Error checking payment status:",s),x>10&&(c(!0),o("Could not confirm payment status. Please check your M-Pesa app or contact support."),b())}},b=()=>{f(15)},B=s=>{s.preventDefault(),l(!0),m(!1),o(""),h(!1),c(!1),k(null),f(0);let t=j.trim();if(t=t.replace(/\D/g,""),t.startsWith("0")?t="254"+t.substring(1):t.startsWith("+254")?t=t.substring(1):t.startsWith("254")||(t="254"+t),!/^254\d{9}$/.test(t)){l(!1),m(!0),o("Please enter a valid Kenyan phone number");return}p.post("/api/mpesa/stkpush",{phoneNumber:t,amount:C},{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(r=>{l(!1),N(!0),r.data.data&&r.data.data.CheckoutRequestID&&k(r.data.data.CheckoutRequestID),o("M-Pesa payment request sent successfully! Please check your phone to complete the payment.")}).catch(r=>{l(!1),m(!0);const H=r.response?.data?.message||r.message||"Failed to initiate M-Pesa payment.",V=r.response?.data?.error?` Details: ${r.response.data.error}`:"";o(`${H}${V} Please try again.`)})};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[W?e.jsxs(w,{className:"border-border text-card-foreground",children:[e.jsx(S,{children:e.jsx(A,{className:"text-center",children:"Payment Status"})}),e.jsxs(I,{children:[e.jsxs(E,{className:`mb-4 ${n?"text-green-800 dark:text-green-200 bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800":i?"text-red-800 dark:text-red-200 bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800":"text-blue-800 dark:text-blue-200 bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800"}`,children:[e.jsx(D,{children:n?"Success!":i?"Failed!":"Processing..."}),e.jsx(F,{children:v})]}),!n&&!i&&e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"mx-auto h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Waiting for your payment confirmation..."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"(This may take up to 1 minute)"})]}),(n||i)&&e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx(g,{variant:"outline",onClick:()=>{N(!1),m(!1),h(!1),c(!1),o("")},children:"Try Again"}),n&&e.jsxs(g,{onClick:()=>window.location.href="/dashboard",children:["Go to Dashboard",e.jsx(ee,{className:"ml-2 h-4 w-4"})]})]})]})]}):e.jsxs(w,{className:"border-border text-card-foreground",children:[e.jsxs(S,{children:[e.jsx(A,{className:"text-center",children:u}),e.jsx(G,{className:"text-center",children:L})]}),e.jsxs("form",{onSubmit:B,children:[e.jsxs(I,{className:"space-y-4",children:[K&&e.jsxs(E,{variant:"destructive",className:"mb-4",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(D,{children:"Error"}),e.jsx(F,{children:v})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"phoneNumber",className:"block text-sm font-medium",children:"Phone Number"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-input bg-muted text-muted-foreground",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(M,{id:"phoneNumber",type:"text",placeholder:"e.g., 0712345678 or +254712345678",value:j,onChange:s=>T(s.target.value),className:"rounded-l-none"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter your phone number starting with 0 or 254 (e.g., 0712345678 or 254712345678)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium",children:"Amount (KES)"}),e.jsx(M,{id:"amount",type:"text",value:C,onChange:s=>_(s.target.value),readOnly:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pro Membership Fee - 1000 KES"})]})]}),e.jsx(O,{children:e.jsx(g,{type:"submit",className:"w-full bg-green-600 hover:bg-green-700 text-white",disabled:P,children:P?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Pay Pro Membership Fee"})})]})]}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Powered by"}),e.jsx("img",{src:"/images/mpesa-logo.png",alt:"M-Pesa Logo",className:"h-8 mx-auto"})]})]})};function We(){const u=[{title:"Pro Membership Payment",href:"/mpesa-payment"}];return e.jsxs(J,{breadcrumbs:u,children:[e.jsx(X,{title:"Pro Membership Payment"}),e.jsx(y.div,{variants:Y,initial:"hidden",animate:"visible",className:"flex h-full flex-1 flex-col gap-6 p-6",children:e.jsx(y.div,{variants:R,className:"max-w-xl mx-auto w-full",children:e.jsxs(Q,{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Pro Membership Payment"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Upgrade to Pro Membership by paying via M-Pesa"})]}),e.jsx(y.div,{variants:R,children:e.jsx(ae,{title:"Pro Membership Payment",description:"Pay your Pro Membership fee of KES 1,000 via M-Pesa"})})]})})})]})}export{We as default};
