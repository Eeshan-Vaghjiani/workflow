import{a as l,r as f,j as e}from"./app-Bpl7UGUW.js";import{D as k,a as C,b as _,c as E}from"./dialog-CbTZdYFt.js";import{B as b}from"./button-nI1-8HXs.js";import{I as j}from"./input-CQiJ7d6K.js";import{L as h}from"./label-Djyhicxk.js";import{C as $}from"./checkbox-BmlmTqqC.js";const m="/api/admin",v={getUsers:async(s={})=>(await l.get(`${m}/users`,{params:s})).data,createUser:async s=>(await l.post(`${m}/users`,s)).data.user,updateUser:async(s,n)=>(await l.put(`${m}/users/${s}`,n)).data.user,deleteUser:async s=>{await l.delete(`${m}/users/${s}`)},restoreUser:async s=>{await l.post(`${m}/users/${s}/restore`)},downloadPdf:async()=>{const s=await l.get(`${m}/users/pdf`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([s.data])),o=document.createElement("a");o.href=n,o.setAttribute("download",`users-report-${new Date().toISOString().split("T")[0]}.pdf`),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(n)}};function D({isOpen:s,onClose:n,onSuccess:o,user:t}){const[r,u]=f.useState({name:"",email:"",password:"",is_admin:!1}),[d,c]=f.useState({}),[U,g]=f.useState(!1);f.useEffect(()=>{s&&(c({}),u(t?{name:t.name,email:t.email,password:"",is_admin:t.role==="ADMIN"}:{name:"",email:"",password:"",is_admin:!1}))},[s,t]);const y=()=>{const a={};return r.name.trim()||(a.name="Name is required"),r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(a.email="Email is invalid"):a.email="Email is required",!t&&!r.password?.trim()?a.password="Password is required for new users":r.password&&r.password.length<8&&(a.password="Password must be at least 8 characters"),c(a),Object.keys(a).length===0},S=async a=>{if(a.preventDefault(),!!y()){g(!0);try{t?await v.updateUser(t.id,r):await v.createUser(r),o()}catch(i){console.error("Error saving user:",i);const p=i;p.response?.data?.errors?c(p.response.data.errors):c({form:p.response?.data?.message||"An error occurred while saving the user"})}finally{g(!1)}}},w=a=>{const{name:i,value:p}=a.target;u(x=>({...x,[i]:p})),d[i]&&c(x=>({...x,[i]:void 0}))};return e.jsx(k,{open:s,onOpenChange:n,children:e.jsxs(C,{children:[e.jsx(_,{children:e.jsx(E,{children:t?"Edit User":"Add New User"})}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[d.form&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-3 rounded-md text-sm",children:d.form}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"name",children:"Name"}),e.jsx(j,{id:"name",name:"name",value:r.name,onChange:w,error:d.name})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"email",children:"Email"}),e.jsx(j,{id:"email",name:"email",type:"email",value:r.email,onChange:w,error:d.email})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"password",children:t?"Password (leave blank to keep current)":"Password"}),e.jsx(j,{id:"password",name:"password",type:"password",value:r.password,onChange:w,error:d.password})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{id:"is_admin",checked:r.is_admin,onCheckedChange:a=>u(i=>({...i,is_admin:!!a}))}),e.jsx(h,{htmlFor:"is_admin",children:"Admin User"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(b,{type:"button",variant:"outline",onClick:n,children:"Cancel"}),e.jsx(b,{type:"submit",isLoading:U,children:t?"Update User":"Add User"})]})]})]})})}const R=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));export{D as U,R as a,v as u};
